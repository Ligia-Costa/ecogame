<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGame - Jogo Virtual</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="shortcut icon" href="icone.ico" type="image/x-icon">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #06b6d4;
            --secondary: #3b82f6;
            --accent: #8b5cf6;
            --danger: #ef4444;
            --success: #10b981;
            --dark: #0f172a;
            --light: #f8fafc;
            --ice: #e0f2fe;
            --frost: #cbd5e1;
            --glacier: #94a3b8;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: var(--light);
            overflow-x: hidden;
            min-height: 100vh;
            user-select: none;
        }

        /* Container principal responsivo */
        .game-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Telas do jogo */
        .screen {
            display: none;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tela de Sele√ß√£o de Mat√©ria - Cores frias */
        .subject-selection {
            background: linear-gradient(135deg, #1e3a8a, #3730a3);
        }

        .subject-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--ice);
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 1200px;
            margin-bottom: 2rem;
        }

        .subject-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(55, 48, 163, 0.2));
            border: 2px solid rgba(96, 165, 250, 0.3);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .subject-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
            box-shadow: 0 15px 35px rgba(6, 182, 212, 0.2);
        }

        .subject-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        .subject-name {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--ice);
        }

        .subject-description {
            font-size: 0.95rem;
            opacity: 0.9;
            margin-bottom: 1rem;
            line-height: 1.4;
            color: var(--frost);
        }

        .subject-count {
            background: rgba(6, 182, 212, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            display: inline-block;
            color: var(--primary);
            border: 1px solid rgba(6, 182, 212, 0.3);
        }

        /* Tela de Sele√ß√£o de Avatar - Cores frias */
        .avatar-screen {
            background: linear-gradient(135deg, #1e3a8a, #4338ca);
        }

        .avatar-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--ice);
        }

        .avatar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            width: 100%;
            max-width: 1000px;
            margin-bottom: 2rem;
        }

        .avatar-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.3), rgba(55, 48, 163, 0.2));
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            border: 2px solid rgba(96, 165, 250, 0.3);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .avatar-card:hover {
            transform: translateY(-8px);
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.4), rgba(55, 48, 163, 0.3));
        }

        .avatar-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(139, 92, 246, 0.1));
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.4);
        }

        .avatar-icon {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3));
        }

        .avatar-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 1rem;
            border: 3px solid rgba(96, 165, 250, 0.5);
            transition: var(--transition);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .avatar-card.selected .avatar-image {
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .avatar-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--ice);
        }

        .avatar-subject {
            font-size: 0.9rem;
            opacity: 0.8;
            color: var(--frost);
        }

        /* Tela do Jogo - Cores frias */
        .game-screen {
            background: linear-gradient(to bottom, #1e3a8a, #1e1b4b);
            position: relative;
            padding: 0;
            justify-content: flex-start;
        }

        /* HUD Responsivo */
        .hud {
            position: relative;
            width: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 0 0 20px 20px;
            padding: 1rem;
            color: var(--ice);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            z-index: 100;
            border-bottom: 1px solid rgba(96, 165, 250, 0.3);
        }

        .hud-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
            min-width: 200px;
        }

        .hud-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary);
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
        }

        .hud-stats {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            flex: 1;
        }

        .stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--ice);
        }

        .stat i {
            color: var(--primary);
        }

        .progress-bar {
            width: 120px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Container do Canvas responsivo (MODIFICADO) */
        .game-canvas-container {
            flex: 1; /* Faz o container ocupar o espa√ßo vertical restante */
            width: 100%; /* Ocupa toda a largura */
            margin-top: 1rem; /* Adiciona um espa√ßo entre a HUD e o canvas */
            background: #0f172a;
            overflow: hidden;
            position: relative;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Controles com novo layout */
        .controls-help {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1rem 1.5rem;
            color: var(--ice);
            z-index: 90;
            border: 1px solid rgba(96, 165, 250, 0.2);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .controls-title {
            font-weight: 700;
            color: var(--primary);
            text-align: center;
            border-bottom: 1px solid rgba(96, 165, 250, 0.2);
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--glacier);
            text-transform: uppercase;
            text-align: center;
        }

        .key-group {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
        }
        
        .key-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .key {
            background: rgba(6, 182, 212, 0.2);
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-family: monospace;
            font-weight: 600;
            font-size: 0.85rem;
            min-width: 45px;
            text-align: center;
            border: 1px solid rgba(6, 182, 212, 0.3);
            color: var(--primary);
        }

        /* Bot√µes */
        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            text-decoration: none;
            min-width: 200px;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
        }

        .btn-secondary {
            background: rgba(96, 165, 250, 0.15);
            backdrop-filter: blur(10px);
            color: var(--ice);
            border: 1px solid rgba(96, 165, 250, 0.3);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Tela de Game Over - Cores frias */
        .gameover-screen {
            background: linear-gradient(135deg, #1e3a8a, #3730a3);
        }

        .gameover-card {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.4), rgba(55, 48, 163, 0.3));
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 3rem 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(96, 165, 250, 0.3);
            text-align: center;
        }

        .gameover-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            animation: pulse 2s infinite;
            color: var(--primary);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .gameover-title {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            margin-bottom: 2rem;
            color: var(--ice);
        }

        .gameover-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 15px;
            padding: 1.5rem 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(96, 165, 250, 0.2);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            color: var(--frost);
        }

        /* Modais */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .modal {
            background: linear-gradient(135deg, #1e293b, #334155);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(96, 165, 250, 0.3);
            animation: modalAppear 0.4s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: scale(0.9) translateY(30px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .modal-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .modal-icon {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--ice);
        }

        .modal-body {
            margin-bottom: 2rem;
        }

        .question-text {
            font-size: 1.3rem;
            line-height: 1.5;
            margin-bottom: 1.5rem;
            color: var(--ice);
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 1.2rem;
            text-align: left;
            font-size: 1.1rem;
            color: white;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(10px);
        }

        .option-letter {
            background: var(--primary);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .feedback-modal {
            text-align: center;
        }

        .feedback-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
        }

        .feedback-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .feedback-message {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.5;
            color: var(--ice);
        }

        .feedback-bonus {
            font-size: 1.1rem;
            color: var(--accent);
            font-weight: 600;
        }

        /* Estilos melhorados para a se√ß√£o de controles */
        .controls-help {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            padding: 0;
            color: var(--ice);
            z-index: 90;
            border: 1px solid rgba(96, 165, 250, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            width: 280px;
            max-width: calc(100vw - 2rem);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .controls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(96, 165, 250, 0.2);
            cursor: pointer;
        }

        .controls-title {
            font-weight: 700;
            color: var(--primary);
            font-size: 1.1rem;
            margin: 0;
        }

        .controls-toggle {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: var(--transition);
        }

        .controls-toggle:hover {
            background: rgba(6, 182, 212, 0.1);
        }

        .controls-content {
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .controls-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .control-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--glacier);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .key-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .key-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .key-combo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .key {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(59, 130, 246, 0.2));
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-weight: 600;
            font-size: 0.85rem;
            min-width: 40px;
            text-align: center;
            border: 1px solid rgba(6, 182, 212, 0.3);
            color: var(--primary);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .key.large-key {
            min-width: 80px;
        }

        .key:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .key-separator {
            font-size: 0.75rem;
            color: var(--glacier);
        }

        .key-action {
            font-size: 0.9rem;
            color: var(--ice);
            flex: 1;
            text-align: right;
        }

        /* Estado recolhido */
        .controls-help.collapsed .controls-content {
            display: none;
        }

        .controls-help.collapsed .controls-toggle i {
            transform: rotate(-90deg);
        }

        /* Responsividade para dispositivos m√≥veis */
        @media (max-width: 768px) {
            .controls-help {
                position: relative;
                bottom: auto;
                right: auto;
                margin: 1rem auto;
                width: 100%;
                max-width: 100%;
            }
            
            .controls-help.collapsed {
                margin-bottom: 0;
            }
            
            .key-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .key-action {
                text-align: left;
                padding-left: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .controls-help {
                border-radius: 12px;
            }
            
            .controls-header {
                padding: 0.75rem 1rem;
            }
            
            .controls-content {
                padding: 1rem;
            }
            
            .key {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
                min-width: 35px;
            }
            
            .key.large-key {
                min-width: 70px;
            }
        }

        .hint-modal {
            max-width: 500px;
            text-align: center;
        }

        .hint-modal .modal-header {
            justify-content: center;
            border-bottom: 1px solid rgba(96, 165, 250, 0.2);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .hint-modal .modal-body {
            padding: 1rem 0;
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--ice);
        }

        .hint-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            border: 3px solid var(--primary);
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        /* Responsividade para dispositivos m√≥veis */
        @media (max-width: 768px) {
            .game-container {
                padding: 0.5rem;
            }
            
            .screen {
                padding: 0.5rem;
            }
            
            .subject-grid,
            .avatar-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .subject-card,
            .avatar-card {
                padding: 1.5rem 1rem;
            }
            
            .hud {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
                border-radius: 0 0 15px 15px;
            }
            
            .hud-section {
                min-width: 100%;
                justify-content: space-between;
            }
            
            .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .btn {
                width: 100%;
                min-width: auto;
            }
            
            .controls-help {
                position: relative;
                bottom: auto;
                right: auto;
                margin: 1rem auto;
                max-width: 100%;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .gameover-stats {
                grid-template-columns: 1fr;
            }
            
            .gameover-card {
                padding: 2rem 1rem;
            }
            
            .modal {
                padding: 1.5rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .subject-card,
            .avatar-card {
                padding: 1rem;
            }
            
            .subject-icon,
            .avatar-icon {
                font-size: 2.5rem;
            }
            
            .subject-name,
            .avatar-name {
                font-size: 1.1rem;
            }
            
            .hud {
                padding: 0.8rem;
            }
            
            .hud-avatar {
                width: 50px;
                height: 50px;
            }
            
            .stat {
                font-size: 0.8rem;
            }
            
            .progress-bar {
                width: 80px;
            }
            
            .btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div id="subject-selection" class="screen subject-selection active">
            <h2 class="subject-title">Escolha sua Mat√©ria</h2>
            
            <div class="subject-grid" id="subject-grid">
                </div>
            
            <div class="btn-group">
                <a href="index.html" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Voltar ao Menu
                </a>
            </div>
        </div>

        <div id="avatar-screen" class="screen avatar-screen">
            <h2 class="avatar-title">Escolha seu Avatar em <span id="current-subject-name">Mat√©ria</span></h2>
            
            <div id="avatar-grid" class="avatar-grid">
                </div>
            
            <div class="btn-group">
                <button id="back-to-subjects" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Voltar √†s Mat√©rias
                </button>
                <button id="select-avatar-button" class="btn btn-primary" style="display: none;">
                    <i class="fas fa-rocket"></i> Iniciar Miss√£o
                </button>
            </div>
        </div>

        <div id="game-screen" class="screen game-screen">
            <div class="hud">
                <div class="hud-section">
                    <div id="hud-avatar" class="hud-avatar">üë®‚Äçüéì</div>
                    <div class="hud-stats">
                        <div class="stat">
                            <i class="fas fa-star"></i>
                            Pontua√ß√£o: <span id="score">0</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-heart"></i>
                            Vidas: <span id="lives">3</span>
                        </div>
                    </div>
                </div>
                
                <div class="hud-section">
                    <div class="hud-stats">
                        <div class="stat">
                            <i class="fas fa-seedling"></i>
                            Sementes: <span id="seeds-collected">0</span>
                        </div>
                        <div class="stat">
                            <i class="fas fa-leaf"></i>
                            Progresso
                            <div class="progress-bar">
                                <div id="environment-progress" class="progress-fill" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="hud-section" style="justify-content: flex-end; gap: 1rem;">
                    <button id="back-button" class="btn btn-secondary" style="padding: 0.8rem 1.5rem;">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </button>
                    <button id="pause-button" class="btn btn-secondary" style="padding: 0.8rem 1.5rem;">
                        <i class="fas fa-pause"></i> Pausar
                    </button>
                </div>
            </div>

            <div class="game-canvas-container">
                <canvas id="gameCanvas" width="2000" height="600"></canvas>
            </div>

            <!-- Substitua a se√ß√£o .controls-help atual por este c√≥digo melhorado -->
            <div class="controls-help">
                <div class="controls-header">
                    <div class="controls-title">Controles</div>
                    <button class="controls-toggle" aria-label="Mostrar/ocultar controles">
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                
                <div class="controls-content">
                    <div class="controls-section">
                        <div class="control-group">
                            <div class="control-label">Movimento</div>
                            <div class="key-group">
                                <div class="key-row">
                                    <div class="key-combo">
                                        <span class="key">W</span>
                                        <span class="key-separator">ou</span>
                                        <span class="key">‚Üë</span>
                                    </div>
                                    <span class="key-action">Pular</span>
                                </div>
                                <div class="key-row">
                                    <div class="key-combo">
                                        <span class="key">A</span>
                                        <span class="key-separator">ou</span>
                                        <span class="key">‚Üê</span>
                                    </div>
                                    <span class="key-action">Esquerda</span>
                                </div>
                                <div class="key-row">
                                    <div class="key-combo">
                                        <span class="key">D</span>
                                        <span class="key-separator">ou</span>
                                        <span class="key">‚Üí</span>
                                    </div>
                                    <span class="key-action">Direita</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="control-group">
                            <div class="control-label">A√ß√µes</div>
                            <div class="key-group">
                                <div class="key-row">
                                    <div class="key-combo">
                                        <span class="key large-key">Espa√ßo</span>
                                    </div>
                                    <span class="key-action">Coletar</span>
                                </div>
                                <div class="key-row">
                                    <div class="key-combo">
                                        <span class="key">ESC</span>
                                    </div>
                                    <span class="key-action">Pausar</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="gameover-screen" class="screen gameover-screen">
            <div class="gameover-card">
                <div class="gameover-icon">üåç</div>
                <h2 class="gameover-title">Miss√£o Conclu√≠da!</h2>
                <div class="gameover-stats">
                    <div class="stat-card">
                        <div id="final-score" class="stat-value">0</div>
                        <div class="stat-label">Pontua√ß√£o</div>
                    </div>
                    <div class="stat-card">
                        <div id="final-seeds" class="stat-value">0/15</div>
                        <div class="stat-label">Sementes</div>
                    </div>
                    <div class="stat-card">
                        <div id="final-environment" class="stat-value">√Årido</div>
                        <div class="stat-label">N√≠vel Ambiental</div>
                    </div>
                </div>
                <div class="btn-group">
                    <button id="restart-button" class="btn btn-primary">
                        <i class="fas fa-redo"></i> Jogar Novamente
                    </button>
                    <button id="menu-button" class="btn btn-secondary">
                        <i class="fas fa-home"></i> Menu Principal
                    </button>
                </div>
            </div>
        </div>

        <div id="question-overlay" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <div class="modal-icon">
                        <img id="question-avatar-img" src="" alt="Avatar" style="width: 50px; height: 50px; border-radius: 50%;">
                    </div>
                    <h3 class="modal-title">Desafio Educacional</h3>
                </div>
                <div class="modal-body">
                    <div id="question-text" class="question-text"></div>
                    <div id="options-container" class="options-grid"></div>
                </div>
                <div class="modal-footer" style="text-align: right; margin-top: 1rem;">
                    <button id="hint-button" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">
                        <i class="fas fa-lightbulb"></i> Dica
                    </button>
                </div>
            </div>
        </div>

        <div id="hint-overlay" class="modal-overlay" style="display: none;">
            <div class="modal hint-modal">
                <div class="modal-header">
                    <div class="modal-icon">
                        <img id="hint-avatar-img" src="" alt="Avatar da Dica" class="hint-avatar">
                    </div>
                    <h3 class="modal-title">Uma Dica para Voc√™!</h3>
                </div>
                <div class="modal-body">
                    <p id="hint-text" style="font-size: 1.2rem; line-height: 1.6; margin: 0;">
                        A resposta correta geralmente est√° relacionada ao uso consciente dos recursos e √† sustentabilidade.
                    </p>
                </div>
                <div class="modal-footer" style="margin-top: 1.5rem; text-align: center;">
                    <button id="close-hint-button" class="btn btn-primary">Entendi, obrigado!</button>
                </div>
            </div>
        </div>

        <div id="feedback-overlay" class="modal-overlay">
            <div class="modal feedback-modal">
                <div id="feedback-icon" class="feedback-icon"></div>
                <h3 id="feedback-title" class="feedback-title"></h3>
                <div id="feedback-message" class="feedback-message"></div>
                <div id="feedback-bonus" class="feedback-bonus"></div>
            </div>
        </div>
    </div>

    <script>
        // Dados dos avatares por mat√©ria
        const avatarsBySubject = {
            'matematica': [
                { id: 'matematica_1', name: 'A Calculista', subject: 'Matem√°tica', color: '#3B82F6', icon: 'üßÆ', image: 'marcia.png' },
                { id: 'matematica_2', name: 'O Preciso', subject: 'Matem√°tica', color: '#6366F1', icon: 'üìê', image: 'romulo.png' },
                { id: 'matematica_3', name: 'O Solucionador', subject: 'Matem√°tica', color: '#8B5CF6', icon: 'üî¢', image: 'anderson.png' }
            ],
            'lingua_portuguesa': [
                { id: 'portugues_1', name: 'A Articulada', subject: 'L√≠ngua Portuguesa', color: '#EF4444', icon: 'üìö', image: 'lucilene.png' },
                { id: 'portugues_2', name: 'A Eloquente', subject: 'L√≠ngua Portuguesa', color: '#DC2626', icon: 'üìñ', image: 'marieli.png' },
                { id: 'portugues_3', name: 'O Expressivo', subject: 'L√≠ngua Portuguesa', color: '#B91C1C', icon: '‚úçÔ∏è', image: 'demetrius.png' }
            ],
            'biologia': [
                { id: 'biologia', name: 'A Vital', subject: 'Biologia', color: '#10B981', icon: 'üß¨', image: 'mayara.png' }
            ],
            'fisica': [
                { id: 'fisica', name: 'O Racional', subject: 'F√≠sica', color: '#8B5CF6', icon: '‚öõÔ∏è', image: 'romulo.png' }
            ],
            'quimica': [
                { id: 'quimica', name: 'A Anal√≠tica', subject: 'Qu√≠mica', color: '#F59E0B', icon: 'üß™', image: 'arline.png' }
            ],
            'historia': [
                { id: 'historia', name: 'O S√°bio', subject: 'Hist√≥ria', color: '#92400E', icon: 'üìú', image: 'julio.png' }
            ],
            'geografia': [
                { id: 'geografia', name: 'A Cart√≥grafa', subject: 'Geografia', color: '#059669', icon: 'üåç', image: 'jesiane.png' }
            ],
            'ingles': [
                { id: 'ingles', name: 'A Gringa', subject: 'Ingl√™s', color: '#DC2626', icon: 'üá∫üá∏', image: 'flavia.png' }
            ],
            'arte': [
                { id: 'arte', name: 'A Musa Inspiradora', subject: 'Arte', color: '#EC4899', icon: 'üé®', image: 'marcela.png' }
            ],
            'educacao_fisica': [
                { id: 'educacao_fisica', name: 'O Energ√©tico', subject: 'Educa√ß√£o F√≠sica', color: '#F97316', icon: '‚öΩ', image: 'fabricio.png' }
            ],
            'filosofia': [
                { id: 'filosofia', name: 'O Questionador', subject: 'Filosofia', color: '#6366F1', icon: 'ü§î', image: 'julio.png' }
            ],
            'sociologia': [
                { id: 'sociologia', name: 'O Observador', subject: 'Sociologia', color: '#84CC16', icon: 'üë•', image: 'julio.png' }
            ]
        };

        // Mat√©rias dispon√≠veis para sele√ß√£o inicial
        const subjects = [
            { id: 'matematica', name: 'Matem√°tica', icon: 'üßÆ', color: '#3B82F6', description: 'Quantifique o equil√≠brio do futuro, desenhando caminhos para a inova√ß√£o verde.' },
            { id: 'lingua_portuguesa', name: 'L√≠ngua Portuguesa', icon: 'üìö', color: '#EF4444', description: 'Domine a narrativa que inspira a a√ß√£o e articula o valor da nossa natureza.' },
            { id: 'biologia', name: 'Biologia', icon: 'üß¨', color: '#10B981', description: 'Investigue a ess√™ncia vital, otimizando o uso respons√°vel dos recursos terrestres.' },
            { id: 'fisica', name: 'F√≠sica', icon: '‚öõÔ∏è', color: '#8B5CF6', description: 'Desvende a energia e a mat√©ria para construir tecnologias mais eficientes e limpas.' },
            { id: 'quimica', name: 'Qu√≠mica', icon: 'üß™', color: '#F59E0B', description: 'Transforme elementos, criando ciclos fechados e materiais que respeitam o planeta.' },
            { id: 'historia', name: 'Hist√≥ria', icon: 'üìú', color: '#92400E', description: 'Analise os legados do passado para forjar um novo modelo de prosperidade e cuidado.' },
            { id: 'geografia', name: 'Geografia', icon: 'üåç', color: '#059669', description: 'Mapeie os territ√≥rios e a gest√£o do espa√ßo para o conv√≠vio harmonioso entre esp√©cies.' },
            { id: 'ingles', name: 'Ingl√™s', icon: 'üá∫üá∏', color: '#DC2626', description: 'Abra a conversa global sobre as pr√°ticas de inova√ß√£o e o futuro do planeta.' },
            { id: 'arte', name: 'Arte', icon: 'üé®', color: '#EC4899', description: 'Use a criatividade para sensibilizar e expressar a import√¢ncia do nosso meio ambiente.' },
            { id: 'educacao_fisica', name: 'Educa√ß√£o F√≠sica', icon: '‚öΩ', color: '#F97316', description: 'Cultive a sa√∫de individual, o pilar de uma comunidade forte e consciente.' },
            { id: 'filosofia', name: 'Filosofia', icon: 'ü§î', color: '#6366F1', description: 'Questione a responsabilidade e o papel humano diante dos limites da Terra.' },
            { id: 'sociologia', name: 'Sociologia', icon: 'üë•', color: '#84CC16', description: 'Compreenda as rela√ß√µes humanas e o impacto das escolhas coletivas no ambiente.' }
        ];

        // Estado do jogo
        let gameState = {
            phase: 'subject', // Agora come√ßa na sele√ß√£o de mat√©ria
            selectedSubject: null,
            selectedAvatar: null,
            score: 0,
            level: 1,
            lives: 3,
            questionsAnswered: 0,
            totalQuestions: 15,
            environmentLevel: 0,
            paused: false,
            environmentState: '√°rido'
        };

        // Vari√°veis do jogo
        let gameQuestions = [];
        let player = {
            x: 100,
            y: 400,
            width: 60, // Aumentado de 40 para 60
            height: 80, // Aumentado de 60 para 80
            velocityX: 0,
            velocityY: 0,
            speed: 5,
            jumpForce: -15,
            isJumping: false,
            direction: 'right'
        };
        let platforms = [];
        let seeds = [];
        let currentQuestion = null;
        let keys = {};
        let camera = { x: 0, y: 0 };
        let particles = [];
        let playerImage = new Image();
        let hudAvatarImage = new Image();

        // Constantes do jogo
        const GRAVITY = 0.8;
        const GROUND_LEVEL = 500;

        // Elementos DOM
        const screens = {
            subject: document.getElementById('subject-selection'),
            avatar: document.getElementById('avatar-screen'),
            playing: document.getElementById('game-screen'),
            gameOver: document.getElementById('gameover-screen')
        };
        const subjectGrid = document.getElementById('subject-grid');
        const currentSubjectName = document.getElementById('current-subject-name');
        const backToSubjectsButton = document.getElementById('back-to-subjects');
        const avatarGrid = document.getElementById('avatar-grid');
        const selectAvatarButton = document.getElementById('select-avatar-button');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const levelElement = document.getElementById('level');
        const seedsCollectedElement = document.getElementById('seeds-collected');
        const environmentProgress = document.getElementById('environment-progress');
        const questionOverlay = document.getElementById('question-overlay');
        const questionText = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackMessage = document.getElementById('feedback-message');
        const feedbackBonus = document.getElementById('feedback-bonus');
        const finalScoreElement = document.getElementById('final-score');
        const finalSeedsElement = document.getElementById('final-seeds');
        const finalEnvironmentElement = document.getElementById('final-environment');
        const restartButton = document.getElementById('restart-button');
        const menuButton = document.getElementById('menu-button');
        const pauseButton = document.getElementById('pause-button');
        const hintButton = document.getElementById('hint-button');
        const hintOverlay = document.getElementById('hint-overlay');
        const closeHintButton = document.getElementById('close-hint-button');
        const hintAvatarImg = document.getElementById('hint-avatar-img');
        const hintAvatars = ['joao.png', 'rafael.png'];


        // Adicione este c√≥digo ao seu script existente
        function initControlsToggle() {
            const controlsHelp = document.querySelector('.controls-help');
            const controlsToggle = document.querySelector('.controls-toggle');
            const controlsHeader = document.querySelector('.controls-header');
            
            if (controlsToggle && controlsHeader) {
                // Fun√ß√£o para alternar estado
                const toggleControls = () => {
                    controlsHelp.classList.toggle('collapsed');
                    
                    // Salvar prefer√™ncia do usu√°rio
                    const isCollapsed = controlsHelp.classList.contains('collapsed');
                    localStorage.setItem('controlsCollapsed', isCollapsed);
                };
                
                // Adicionar event listeners
                controlsToggle.addEventListener('click', toggleControls);
                controlsHeader.addEventListener('click', toggleControls);
                
                // Restaurar estado salvo
                const savedState = localStorage.getItem('controlsCollapsed');
                if (savedState === 'true') {
                    controlsHelp.classList.add('collapsed');
                }
            }
        }

        // Inicializa√ß√£o do jogo
        function init() {
            console.log('Inicializando jogo...');
            
            // Event listeners
            selectAvatarButton.addEventListener('click', startGame);
            backToSubjectsButton.addEventListener('click', () => showScreen('subject'));
            restartButton.addEventListener('click', restartGame);
            menuButton.addEventListener('click', () => window.location.href = 'index.html');
            pauseButton.addEventListener('click', togglePause);

            // FUNCIONALIDADE DO BOT√ÉO VOLTAR (ADICIONADA)
            const backButton = document.getElementById('back-button');
            backButton.addEventListener('click', () => {
                showScreen('subject'); 
            });

            // L√≥gica do bot√£o de dica (SUBSTITUIR O EXISTENTE)
            hintButton.addEventListener('click', () => {
                if (currentQuestion && currentQuestion.question.hint) {
                    // Usar a dica espec√≠fica da pergunta atual
                    const hintText = document.getElementById('hint-text');
                    hintText.textContent = currentQuestion.question.hint;
                    
                    // Escolhe um avatar aleat√≥rio para a dica
                    const randomAvatar = hintAvatars[Math.floor(Math.random() * hintAvatars.length)];
                    hintAvatarImg.src = randomAvatar;
                    hintOverlay.style.display = 'flex';
                } else {
                    // Fallback se n√£o houver dica
                    const hintText = document.getElementById('hint-text');
                    hintText.textContent = "Pense cuidadosamente sobre a resposta mais l√≥gica e relacionada √† sustentabilidade.";
                    hintAvatarImg.src = hintAvatars[0];
                    hintOverlay.style.display = 'flex';
                }
            });

            closeHintButton.addEventListener('click', () => {
                hintOverlay.style.display = 'none';
            });

            initControlsToggle();
            
            // Controles de teclado
            window.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                if (e.key === 'Escape') togglePause();
            });
            
            window.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            
            // Popula as grades
            populateSubjectGrid();
            
            console.log('Jogo inicializado');
        }

        function populateSubjectGrid() {
            subjectGrid.innerHTML = '';
            subjects.forEach(subject => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                card.style.borderColor = subject.color;
                card.innerHTML = `
                    <div class="subject-icon">${subject.icon}</div>
                    <div class="subject-name">${subject.name}</div>
                    <div class="subject-description">${subject.description}</div>
                    <div class="subject-count">
                        ${avatarsBySubject[subject.id].length} avatar(s) dispon√≠vel(is)
                    </div>
                `;
                card.addEventListener('click', () => {
                    selectSubject(subject);
                });
                subjectGrid.appendChild(card);
            });
        }

        function populateAvatarGrid(subjectId) {
            const avatars = avatarsBySubject[subjectId];
            avatarGrid.innerHTML = '';
            
            avatars.forEach(avatar => {
                const card = document.createElement('div');
                card.className = 'avatar-card';
                card.innerHTML = `
                    <div class="avatar-icon">${avatar.icon}</div>
                    <div class="avatar-image">
                        <img src="${avatar.image}" alt="${avatar.name}" class="avatar-image">
                    </div>
                    <div class="avatar-name">${avatar.name}</div>
                    <div class="avatar-subject">${avatar.subject}</div>
                `;
                card.addEventListener('click', () => {
                    document.querySelectorAll('.avatar-card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                    gameState.selectedAvatar = avatar;
                    selectAvatarButton.style.display = 'flex';
                });
                avatarGrid.appendChild(card);
            });
        }

        function selectSubject(subject) {
            gameState.selectedSubject = subject;
            currentSubjectName.textContent = subject.name;
            populateAvatarGrid(subject.id);
            showScreen('avatar');
        }

        async function startGame() {
            if (!gameState.selectedAvatar) {
                alert('Por favor, selecione um avatar!');
                return;
            }
            
            console.log('Iniciando jogo com:', gameState.selectedAvatar);
            await loadQuestions();
            initializeGame();
            showScreen('playing');
            gameLoop();
        }

        async function loadQuestions() {
            try {
                console.log('Carregando perguntas para:', gameState.selectedSubject.id);
                const response = await fetch('questions.json');
                const allQuestions = await response.json();
                
                const rawQuestions = allQuestions[gameState.selectedSubject.id];
                
                if (!rawQuestions) {
                    throw new Error(`N√£o h√° perguntas para ${gameState.selectedSubject.id}`);
                }
                
                // Processar as primeiras 15 perguntas COM DICAS
                gameQuestions = rawQuestions.slice(0, 15).map((q, index) => {
                    const correctAnswerChar = q.resposta_correta.trim().charAt(0).toUpperCase();
                    const correctIndex = q.alternativas.findIndex(alt => 
                        alt.trim().charAt(0).toUpperCase() === correctAnswerChar
                    );

                    return {
                        id: index + 1,
                        question: q.pergunta,
                        options: [...q.alternativas],
                        correct: correctIndex,
                        explanation: `Resposta correta: ${q.alternativas[correctIndex]}`,
                        hint: q.dica || "Pense cuidadosamente sobre a resposta mais l√≥gica." // ADICIONAR DICA
                    };
                });

                console.log(`Carregadas ${gameQuestions.length} perguntas de ${gameState.selectedSubject.name}`);
                
            } catch (error) {
                console.error('Erro ao carregar perguntas:', error);
                // Perguntas de fallback COM DICAS
                gameQuestions = Array.from({ length: 15 }, (_, i) => ({
                    id: i + 1,
                    question: `Pergunta ${i + 1} sobre ${gameState.selectedSubject.name}: Qual √© o principal conceito de sustentabilidade?`,
                    options: [
                        "A) Uso respons√°vel dos recursos naturais",
                        "B) Explora√ß√£o m√°xima dos recursos",
                        "C) Ignorar impactos ambientais", 
                        "D) Foco apenas no lucro"
                    ],
                    correct: 0,
                    explanation: "A sustentabilidade envolve o uso respons√°vel dos recursos naturais.",
                    hint: "Pense no equil√≠brio entre desenvolvimento e preserva√ß√£o ambiental." // DICA PADR√ÉO
                }));
            }
        }

        function collectSeed(seed) {
            seed.collected = true;
            createParticles(seed.x, seed.y, 10, '#FFD700');
            
            // Mostrar pergunta
            const questionIndex = seed.questionId - 1;
            
            if (gameQuestions[questionIndex]) {
                const question = gameQuestions[questionIndex];
                showQuestion(question, seed);
            } else {
                // SE N√ÉO HOUVER PERGUNTA, CONSIDERAR CORRETA E DAR PONTOS
                console.warn(`Nenhuma pergunta encontrada para a semente ${seed.questionId}`);
                gameState.score += 10;
                gameState.questionsAnswered++;
                showFeedback(true, "Parab√©ns! Voc√™ coletou uma semente especial!", "+10 pontos!");
                
                if (gameState.questionsAnswered >= gameState.totalQuestions) {
                    setTimeout(() => completeLevel(), 1500);
                }
                updateHUD();
            }
        }

        // Fun√ß√£o para melhor distribui√ß√£o das sementes com mais plataformas
        function createSeeds(){
            seeds = [];
            let seedCount = 0;
            
            // Colocar 1 semente em cada plataforma flutuante (10 plataformas flutuantes)
            for (let i = 1; i < platforms.length; i++) { // Come√ßa do 1 para pular o ch√£o
                // Posicionar semente em posi√ß√£o variada na plataforma (n√£o sempre no centro)
                const platform = platforms[i];
                let xPos;
                
                // Alternar entre esquerda, centro e direita da plataforma
                const positionType = i % 3;
                if (positionType === 0) {
                    xPos = platform.x + 20; // Esquerda
                } else if (positionType === 1) {
                    xPos = platform.x + platform.width / 2 - 10; // Centro
                } else {
                    xPos = platform.x + platform.width - 40; // Direita
                }
                
                seeds.push({
                    x: xPos,
                    y: platform.y - 40,
                    width: 20,
                    height: 20,
                    collected: false,
                    questionId: seedCount + 1,
                    color: '#FFD700',
                    platformIndex: i
                });
                seedCount++;
            }
            
            // Colocar as sementes restantes no ch√£o (plataforma 0) - BEM ESPALHADAS NO CH√ÉO DE 2000
            const remainingSeeds = 15 - seedCount;
            const groundPlatform = platforms[0];
            
            // Posi√ß√µes pr√©-definidas para as sementes do ch√£o (bem espa√ßadas em 2000px)
            const groundPositions = [
                300,   // Come√ßa mais adiante
                500,   // 
                1000,   // 
                1200,   // 
                1400,  // Meio
                1500,  // 
                1750,  // 
                
            ];
            
            for (let i = 0; i < remainingSeeds; i++) {
                const xPos = groundPositions[i % groundPositions.length] + (Math.random() * 40 - 20);
                
                seeds.push({
                    x: Math.max(20, Math.min(groundPlatform.width - 40, xPos)),
                    y: groundPlatform.y - 40,
                    width: 20,
                    height: 20,
                    collected: false,
                    questionId: seedCount + 1,
                    color: '#FFD700',
                    platformIndex: 0
                });
                seedCount++;
            }}

        function updateEnvironmentState() {
            const seeds = gameState.questionsAnswered;
            if (seeds < 4) {
                gameState.environmentState = '√°rido';
            } else if (seeds < 8) {
                gameState.environmentState = 'brotando';
            } else if (seeds < 12) {
                gameState.environmentState = 'crescendo';
            } else {
                gameState.environmentState = 'exuberante';
            }
        }

        function initializeGame() {
            console.log('Inicializando mundo do jogo...');
            
            // Resetar estado
            gameState.score = 0;
            gameState.lives = 3;
            gameState.questionsAnswered = 0;
            gameState.environmentLevel = 0;
            gameState.paused = false;
            updateEnvironmentState();
            
            // Resetar jogador
            player.x = 100;
            player.y = 400;
            player.width = 150;  
            player.height = 150;
            player.velocityX = 0;
            player.velocityY = 0;
            player.isJumping = false;
            
            // Carregar imagem do avatar selecionado
            if (gameState.selectedAvatar && gameState.selectedAvatar.image) {
                playerImage.src = gameState.selectedAvatar.image;
                hudAvatarImage.src = gameState.selectedAvatar.image;
                console.log('Carregando imagem do avatar:', gameState.selectedAvatar.image);
            }
            
            // Criar plataformas - MAIS PLATAFORMAS ADICIONADAS
            platforms = [
                // Ch√£o principal ESTENDIDO
                { x: 0, y: GROUND_LEVEL, width: 2000, height: 100, color: '#8B4513' },
                
                // Plataformas flutuantes BEM ESPA√áADAS
                { x: 150, y: 320, width: 100, height: 20, color: '#A0522D' },
                { x: 400, y: 250, width: 100, height: 20, color: '#A0522D' },
                { x: 650, y: 350, width: 100, height: 20, color: '#A0522D' },
                { x: 900, y: 280, width: 100, height: 20, color: '#A0522D' },
                { x: 1150, y: 200, width: 100, height: 20, color: '#A0522D' },
                { x: 1400, y: 320, width: 100, height: 20, color: '#A0522D' },
                { x: 1650, y: 180, width: 100, height: 20, color: '#A0522D' },
                { x: 250, y: 150, width: 100, height: 20, color: '#A0522D' },
                { x: 750, y: 180, width: 100, height: 20, color: '#A0522D' },
                { x: 1250, y: 380, width: 100, height: 20, color: '#A0522D' }
            ];
            
            // Criar sementes com distribui√ß√£o melhorada
            createSeeds();
            
            // Resetar c√¢mera
            camera.x = 0;
            
            updateHUD();
            console.log('Mundo do jogo inicializado');
        }

        function updateHUD() {
            scoreElement.textContent = gameState.score;
            livesElement.textContent = gameState.lives;
            seedsCollectedElement.textContent = `${gameState.questionsAnswered}/${gameState.totalQuestions}`;
            environmentProgress.style.width = `${(gameState.questionsAnswered / gameState.totalQuestions) * 100}%`;
            
            // Atualizar imagem do HUD
            const hudAvatar = document.getElementById('hud-avatar');
            if (gameState.selectedAvatar && gameState.selectedAvatar.image) {
                hudAvatar.innerHTML = `<img src="${gameState.selectedAvatar.image}" alt="${gameState.selectedAvatar.name}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
            } else {
                hudAvatar.textContent = gameState.selectedAvatar?.icon || 'üë®‚Äçüéì';
            }
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(screen => {
                if (screen) screen.classList.remove('active');
            });
            if (screens[screenName]) {
                screens[screenName].classList.add('active');
                gameState.phase = screenName;
            }
        }

        // Loop principal do jogo
        function gameLoop() {
            if (gameState.phase === 'playing' && !gameState.paused) {
                update();
            }
            render();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            updatePlayer();
            updateCamera();
            checkCollisions();
            updateParticles();
        }

        function updatePlayer() {
            // Movimento horizontal
            player.velocityX = 0;
            
            if (keys['a'] || keys['arrowleft']) {
                player.velocityX = -player.speed;
                player.direction = 'left';
            }
            if (keys['d'] || keys['arrowright']) {
                player.velocityX = player.speed;
                player.direction = 'right';
            }
            
            // Pulo
            if ((keys['w'] || keys['arrowup'] || keys[' ']) && !player.isJumping) {
                player.velocityY = player.jumpForce;
                player.isJumping = true;
            }
            
            // Aplicar gravidade
            player.velocityY += GRAVITY;
            
            // Atualizar posi√ß√£o
            player.x += player.velocityX;
            player.y += player.velocityY;
            
            // Colis√£o com plataformas
            player.isJumping = true;
            platforms.forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y + player.height > platform.y &&
                    player.y < platform.y + platform.height &&
                    player.velocityY > 0) {
                    
                    player.y = platform.y - player.height;
                    player.velocityY = 0;
                    player.isJumping = false;
                }
            });
            
            // Limites do mundo
            if (player.x < 0) player.x = 0;
            if (player.x > canvas.width - player.width) player.x = canvas.width - player.width;
            if (player.y > canvas.height - player.height) {
                player.y = canvas.height - player.height;
                player.velocityY = 0;
                player.isJumping = false;
            }
        }

        function updateCamera() {
            camera.x = player.x - canvas.width / 3;
            camera.x = Math.max(0, Math.min(camera.x, 2000 - canvas.width));
        }

        function checkCollisions() {
            seeds.forEach(seed => {
                if (!seed.collected &&
                    player.x < seed.x + seed.width &&
                    player.x + player.width > seed.x &&
                    player.y < seed.y + seed.height &&
                    player.y + player.height > seed.y) {
                    
                    collectSeed(seed);
                }
            });
        }

        function collectSeed(seed) {
            seed.collected = true;
            createParticles(seed.x, seed.y, 15, '#FFD700');
            
            // Efeito sonoro visual
            gameState.score += 5; // Pontos por coletar
            updateHUD();
            
            // Mostrar pergunta
            const questionIndex = seed.questionId - 1;
            
            if (gameQuestions[questionIndex]) {
                const question = gameQuestions[questionIndex];
                showQuestion(question, seed);
            } else {
                // SE N√ÉO HOUVER PERGUNTA, CONSIDERAR CORRETA E DAR PONTOS
                console.warn(`Nenhuma pergunta encontrada para a semente ${seed.questionId}`);
                gameState.score += 10;
                gameState.questionsAnswered++;
                showFeedback(true, "Parab√©ns! Voc√™ coletou uma semente especial!", "+10 pontos!");
                
                if (gameState.questionsAnswered >= gameState.totalQuestions) {
                    setTimeout(() => completeLevel(), 1500);
                }
                updateHUD();
            }
        }

        function showQuestion(question, seed) {
            currentQuestion = { question, seed };
            gameState.phase = 'question';

            // Define a imagem do avatar da pergunta como isabeli.png
            const avatarImg = document.getElementById('question-avatar-img');
            if (avatarImg) {
                avatarImg.src = 'isabeli.png';
            }
            
            questionText.textContent = question.question;
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.innerHTML = `
                    <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                    <span>${option}</span>
                `;
                button.addEventListener('click', () => answerQuestion(index));
                optionsContainer.appendChild(button);
            });
            
            questionOverlay.style.display = 'flex';
            
            // MOSTRAR BOT√ÉO DE DICA APENAS SE HOUVER DICA DISPON√çVEL
            const hintButton = document.getElementById('hint-button');
            if (question.hint) {
                hintButton.style.display = 'inline-block';
            } else {
                hintButton.style.display = 'none';
            }
        }

        function answerQuestion(selectedIndex) {
            const isCorrect = (selectedIndex === currentQuestion.question.correct);
            
            if (isCorrect) {
                // Resposta correta
                gameState.score += 10;
                gameState.questionsAnswered++;
                updateEnvironmentState();
                showFeedback(true, currentQuestion.question.explanation, "+10 pontos!");
                
                if (gameState.questionsAnswered >= gameState.totalQuestions) {
                    setTimeout(() => completeLevel(), 5000); // 2s feedback + 3s de visualiza√ß√£o
                }
            } else {
                // Resposta incorreta
                gameState.lives--;
                showFeedback(false, currentQuestion.question.explanation, "-1 vida!");
                
                if (gameState.lives <= 0) {
                    setTimeout(() => showGameOver(), 1500);
                } else {
                    // Devolve a semente para poder coletar novamente
                    currentQuestion.seed.collected = false;
                }
            }
            
            updateHUD();
            questionOverlay.style.display = 'none';
        }

        function showFeedback(isCorrect, message, bonus) {
            feedbackIcon.textContent = isCorrect ? 'üéâ' : '‚ùå';
            feedbackTitle.textContent = isCorrect ? 'Resposta Correta!' : 'Resposta Incorreta';
            feedbackTitle.style.color = isCorrect ? '#10B981' : '#EF4444';
            feedbackMessage.textContent = message;
            feedbackBonus.textContent = bonus;
            feedbackOverlay.style.display = 'flex';
            
            setTimeout(() => {
                feedbackOverlay.style.display = 'none';
                if (gameState.lives > 0 && gameState.questionsAnswered < gameState.totalQuestions) {
                    gameState.phase = 'playing';
                }
            }, 2000);
        }

        function completeLevel() {
            showGameOver();
        }

        function showGameOver() {
            finalScoreElement.textContent = gameState.score;
            finalSeedsElement.textContent = `${gameState.questionsAnswered}/15`;
            finalEnvironmentElement.textContent = gameState.environmentState.charAt(0).toUpperCase() + gameState.environmentState.slice(1);
            showScreen('gameOver');
        }

        function createParticles(x, y, count, color) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 8,
                    vy: (Math.random() - 0.5) * 8,
                    life: 30,
                    color: color
                });
            }
        }

        function drawClouds() {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(200, 100, 30, 0, Math.PI * 2);
            ctx.arc(240, 100, 40, 0, Math.PI * 2);
            ctx.arc(280, 100, 30, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.arc(600, 80, 40, 0, Math.PI * 2);
            ctx.arc(650, 80, 50, 0, Math.PI * 2);
            ctx.arc(700, 80, 40, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.arc(1200, 120, 35, 0, Math.PI * 2);
            ctx.arc(1250, 120, 45, 0, Math.PI * 2);
            ctx.arc(1300, 120, 35, 0, Math.PI * 2);
            ctx.fill();
        }

        function updateParticles() {
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.2;
                p.life--;
                
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }
        }

        // Renderiza√ß√£o
        function render() {
            // Define cores e elementos com base no estado do ambiente
            let skyColor, groundColor, platformColor;
            switch (gameState.environmentState) {
                case 'brotando':
                    skyColor = '#2a4d6e';
                    groundColor = '#6B8E23';
                    platformColor = '#556B2F';
                    break;
                case 'crescendo':
                    skyColor = '#3b82f6';
                    groundColor = '#228B22';
                    platformColor = '#006400';
                    break;
                case 'exuberante':
                    skyColor = '#add8e6'; // Azul beb√™
                    groundColor = '#32CD32';
                    platformColor = '#2E8B57';
                    break;
                case '√°rido':
                default:
                    skyColor = '#1e1b4b';
                    groundColor = '#8B4513';
                    platformColor = '#A0522D';
                    break;
            }

            // Limpar canvas
            ctx.fillStyle = skyColor;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Desenha nuvens apenas no est√°gio exuberante, antes da c√¢mera
            if (gameState.environmentState === 'exuberante') {
                drawClouds();
            }

            // Aplicar transforma√ß√£o da c√¢mera
            ctx.save();
            ctx.translate(-camera.x, 0);

            // Desenhar plataformas com a cor do estado atual
            platforms.forEach(platform => {
                const isGround = platform.y === GROUND_LEVEL;
                ctx.fillStyle = isGround ? groundColor : platformColor;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            });

            // Desenhar elementos do ambiente
            const groundY = platforms[0].y;
            for (let x = 0; x < platforms[0].width; x += 50) {
                if (gameState.environmentState === 'brotando') {
                    // Desenha pequenos brotos
                    ctx.fillStyle = 'lightgreen';
                    ctx.fillRect(x + 20, groundY - 5, 3, 5);
                } else if (gameState.environmentState === 'crescendo') {
                    // Desenha grama e flores pequenas
                    ctx.fillStyle = 'green';
                    ctx.fillRect(x + 10, groundY - 10, 3, 10);
                    ctx.fillRect(x + 30, groundY - 15, 3, 15);
                    if (x % 100 === 0) {
                        ctx.fillStyle = 'pink';
                        ctx.beginPath();
                        ctx.arc(x + 25, groundY - 20, 4, 0, Math.PI * 2);
                        ctx.fill();
                    }
                } else if (gameState.environmentState === 'exuberante') {
                    // Desenha grama e flores
                    ctx.fillStyle = 'green';
                    ctx.fillRect(x + 10, groundY - 10, 3, 10);
                    ctx.fillRect(x + 30, groundY - 15, 3, 15);
                    // Flor
                    ctx.fillStyle = 'purple';
                    ctx.beginPath();
                    ctx.arc(x + 40, groundY - 20, 5, 0, Math.PI * 2);
                    ctx.fill();

                    // Desenha uma √°rvore a cada 200 pixels
                    if (x % 200 === 0) {
                        // Tronco
                        ctx.fillStyle = '#8B4513'; // Marrom
                        ctx.fillRect(x + 50, groundY - 80, 20, 80); // Tronco maior
                        // Copa
                        ctx.fillStyle = 'darkgreen';
                        ctx.beginPath();
                        ctx.arc(x + 60, groundY - 100, 40, 0, Math.PI * 2); // Copa maior
                        ctx.fill();
                    }

                    // Desenha um p√°ssaro a cada 300 pixels
                    if (x % 300 === 0) {
                        ctx.fillStyle = 'black';
                        ctx.beginPath();
                        ctx.moveTo(x + 100, 100);
                        ctx.lineTo(x + 110, 110);
                        ctx.lineTo(x + 120, 100);
                        ctx.stroke();
                    }
                }
            }
            
            // Desenhar sementes com efeito de brilho
            seeds.forEach(seed => {
                if (!seed.collected) {
                    // Efeito de pulsa√ß√£o
                    seed.glow = (seed.glow + 0.1) % (Math.PI * 2);
                    const glowIntensity = Math.sin(seed.glow) * 0.3 + 0.7;
                    
                    ctx.fillStyle = `rgba(255, 215, 0, ${glowIntensity})`;
                    ctx.beginPath();
                    ctx.arc(seed.x + seed.width/2, seed.y + seed.height/2, seed.width/2, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Brilho interno
                    ctx.fillStyle = `rgba(255, 255, 255, ${glowIntensity * 0.6})`;
                    ctx.beginPath();
                    ctx.arc(seed.x + seed.width/2, seed.y + seed.height/2, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Contorno
                    ctx.strokeStyle = `rgba(255, 255, 255, ${glowIntensity * 0.8})`;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.arc(seed.x + seed.width/2, seed.y + seed.height/2, seed.width/2, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
            
            // Desenhar part√≠culas
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life / 30;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            
            // Desenhar jogador com imagem do avatar (MAIOR)
            if (playerImage.complete && playerImage.naturalHeight !== 0) {
                // Usar imagem do avatar
                ctx.save();
                if (player.direction === 'left') {
                    ctx.scale(-1, 1);
                    ctx.drawImage(playerImage, -player.x - player.width, player.y, player.width, player.height);
                } else {
                    ctx.drawImage(playerImage, player.x, player.y, player.width, player.height);
                }
                ctx.restore();
            } else {
                // Fallback para desenho b√°sico se a imagem n√£o carregar
                ctx.fillStyle = gameState.selectedAvatar?.color || '#3B82F6';
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                // Desenhar rosto simples
                ctx.fillStyle = '#FFF';
                ctx.beginPath();
                ctx.arc(player.x + player.width/2, player.y + 25, 12, 0, Math.PI * 2);
                ctx.fill();
                
                // Olhos
                ctx.fillStyle = '#000';
                if (player.direction === 'right') {
                    ctx.fillRect(player.x + 35, player.y + 22, 5, 5);
                } else {
                    ctx.fillRect(player.x + 20, player.y + 22, 5, 5);
                }
            }
            
            ctx.restore();
        }

        function togglePause() {
            gameState.paused = !gameState.paused;
            pauseButton.innerHTML = gameState.paused ? 
                '<i class="fas fa-play"></i> Continuar' : 
                '<i class="fas fa-pause"></i> Pausar';
        }

        function restartGame() {
            gameState.level = 1;
            initializeGame();
            showScreen('playing');
        }

        // Iniciar o jogo quando a p√°gina carregar
        window.addEventListener('load', init);
    </script>
</body>
</html>